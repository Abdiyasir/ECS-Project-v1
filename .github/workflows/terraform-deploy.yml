name: Terraform Deployment
on: [push]

env:
  AWS_REGION: ${{ vars.AWS_REGION }}
  TF_VERSION: 1.7.5
  TF_IN_AUTOMATION: true

jobs:
  apply:
    name: Terraform Deployment
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Terraform
        uses: hashicorp/setup-terraform@main
        with:
          terraform_version: latest

      - name: Check Terraform Format
        id: fmt
        run: terraform fmt -check

      - name: Initialise Terraform
        id: init
        run: terraform init

      - name: Validate Terraform
        id: validate
        run: terraform validate -no-color

      - name: Run Terraform Plan
        id: plan
        run: terraform plan -no-color